<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Lanzador de dados â€“ DyD</title>
  <style>
    :root{
      --bg:#0f172a;        /* slate-900 */
      --panel:#0b1220ee;   /* glass panel */
      --card:#0f172acc;    /* cards */
      --text:#e5e7eb;      /* gray-200 */
      --muted:#94a3b8;     /* slate-400 */
      --accent:#38bdf8;    /* sky-400 */
      --ok:#22c55e;        /* green-500 */
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;}

    .app{min-height:100%;display:flex;flex-direction:column}
    header{position:sticky;top:0;z-index:10;background:var(--panel);backdrop-filter:blur(8px);
      border-bottom:1px solid #ffffff22}
    .hdr{max-width:980px;margin:0 auto;padding:14px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between}
    .title{font-weight:800;letter-spacing:.3px}
    .subtitle{color:var(--muted);font-size:.92rem}

    main{flex:1;}
    .wrap{max-width:980px;margin:0 auto;padding:16px}

    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media(min-width:760px){.grid{grid-template-columns:repeat(4,minmax(0,1fr));}}

    .card{background:var(--card);border:1px solid #ffffff22;border-radius:16px;padding:12px;
      box-shadow:0 10px 30px #0006;display:flex;flex-direction:column;gap:10px}
    .icon{position:relative;height:96px;border-radius:12px;background:linear-gradient(145deg,#0e162b,#0a1120);
      display:grid;place-items:center;border:1px solid #ffffff1a;overflow:hidden}
    .icon svg{width:82px;height:82px;filter:drop-shadow(0 4px 10px rgba(0,0,0,.5))}
    .row{display:flex;justify-content:space-between;align-items:center}

    .label{font-weight:700}
    .muted{color:var(--muted);font-size:.9rem}

    .qty{display:flex;align-items:center;gap:8px}
    .qty button{appearance:none;border:none;background:#111827;color:#e5e7eb;border:1px solid #ffffff22;
      width:38px;height:38px;border-radius:12px;font-size:18px;font-weight:800;cursor:pointer}
    .qty .count{min-width:28px;text-align:center;font-weight:800}

    .footerBar{position:sticky;bottom:0;background:var(--panel);backdrop-filter:blur(8px);
      border-top:1px solid #ffffff22}
    .footerWrap{max-width:980px;margin:0 auto;padding:12px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between}
    .summary{color:var(--muted)}
    .btnPrimary{appearance:none;border:none;background:var(--accent);color:#0b1220;font-weight:800;padding:12px 16px;border-radius:14px;box-shadow:0 10px 24px #0008;cursor:pointer}
    .btnPrimary:disabled{opacity:.5;cursor:not-allowed}

    /* ====== SPRITES EN CADA CARD ====== */
    .sprite{position:absolute;inset:8px;display:grid;place-items:center;border-radius:12px;
      background:radial-gradient(120% 120% at 30% 20%, #1e293b 0%, #0b1220 60%, #0b1220 100%);
      border:1px solid #ffffff22;box-shadow:0 10px 24px #0008;pointer-events:none}
    .sprite svg{width:84px;height:84px}
    .sprite.rolling{animation:rollSprite .9s cubic-bezier(.2,.7,.2,1) infinite}
    @keyframes rollSprite{
      0%{transform:translateZ(0) rotateX(0) rotateY(0)}
      50%{transform:translateZ(0) rotateX(180deg) rotateY(90deg)}
      100%{transform:translateZ(0) rotateX(360deg) rotateY(180deg)}
    }
    .sprite.fadeout{animation:fadeOut .3s ease both}
    @keyframes fadeOut{from{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.96)}}

    /* modal */
    .modal{position:fixed;inset:0;background:#0009;display:none;align-items:center;justify-content:center;z-index:40}
    .modal.show{display:flex}
    .modalCard{background:var(--panel);border:1px solid #ffffff22;border-radius:16px;padding:16px 14px;min-width:min(92vw,520px)}
    .modalHead{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .total{font-size:28px;font-weight:900;color:#fff}
    .badge{background:#16a34a22;color:#86efac;border:1px solid #16a34a55;padding:4px 8px;border-radius:999px;font-weight:700}
    .resultList{margin-top:8px;color:#e5e7eb}
    .resultList .line{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #ffffff22}
    .modalActions{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}
    .btn{appearance:none;border:none;border-radius:12px;padding:10px 12px;cursor:pointer}
    .btnGhost{background:transparent;border:1px solid #ffffff44;color:#e5e7eb}
    .btnOk{background:var(--ok);color:#0b1220;font-weight:800}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="hdr">
        <div>
          <div class="title">Lanzador de dados â€“ Dungeons & Dragons</div>
          <div class="subtitle">Selecciona dados y lÃ¡nzalos. AnimaciÃ³n con sprites dentro de cada carta.</div>
        </div>
        <div class="muted" id="selCounter">0 seleccionados</div>
      </div>
    </header>

    <main>
      <div class="wrap">
        <!-- Selector de dados -->
        <div class="grid" id="diceGrid"></div>
      </div>
    </main>

    <div class="footerBar">
      <div class="footerWrap">
        <div class="summary" id="summary">Sin dados seleccionados.</div>
        <button id="btnRoll" class="btnPrimary" disabled>ðŸŽ² Lanzar dados</button>
      </div>
    </div>
  </div>

  <!-- Modal de resultado -->
  <div class="modal" id="modal">
    <div class="modalCard">
      <div class="modalHead">
        <div class="total" id="total">Total: 0</div>
        <div class="badge" id="badge"></div>
      </div>
      <div class="resultList" id="resultList"></div>
      <div class="modalActions">
        <button class="btn btnGhost" id="btnClose">Cerrar</button>
        <button class="btn btnOk" id="btnAgain">Lanzar de nuevo</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const DICE = [
      {key:'d2',  sides:2,  label:'D2'},
      {key:'d4',  sides:4,  label:'D4'},
      {key:'d6',  sides:6,  label:'D6'},
      {key:'d8',  sides:8,  label:'D8'},
      {key:'d10', sides:10, label:'D10'},
      {key:'d12', sides:12, label:'D12'},
      {key:'d20', sides:20, label:'D20'},
      {key:'d100',sides:100,label:'D100'},
    ];

    const state = Object.fromEntries(DICE.map(d=>[d.key,0]));
    const grid = document.getElementById('diceGrid');
    const btnRoll = document.getElementById('btnRoll');
    const selCounter = document.getElementById('selCounter');
    const summary = document.getElementById('summary');

    const modal = document.getElementById('modal');
    const totalEl = document.getElementById('total');
    const badgeEl = document.getElementById('badge');
    const resultList = document.getElementById('resultList');
    const btnClose = document.getElementById('btnClose');
    const btnAgain = document.getElementById('btnAgain');

    // --- Render grid with cards
    grid.innerHTML = DICE.map(d=>cardHTML(d)).join('');
    // attach handlers
    for (const d of DICE){
      const minus = document.querySelector(`[data-key="${d.key}"][data-act="-"]`);
      const plus  = document.querySelector(`[data-key="${d.key}"][data-act="+"]`);
      minus.addEventListener('click', ()=> adjust(d.key,-1));
      plus.addEventListener('click',  ()=> adjust(d.key,+1));
    }

    function adjust(key,delta){
      state[key] = Math.max(0, state[key]+delta);
      updateUI();
    }

    function updateUI(){
      // counts on cards
      for (const d of DICE){
        const cnt = document.querySelector(`[data-key="${d.key}"][data-role="count"]`);
        if (cnt) cnt.textContent = state[d.key];
      }
      // footer summary
      const arr = DICE.filter(d=>state[d.key]>0).map(d=>`${state[d.key]}Ã—${d.label}`);
      const total = DICE.reduce((acc,d)=>acc+state[d.key],0);
      selCounter.textContent = `${total} seleccionados`;
      summary.textContent = arr.length? arr.join(' Â· ') : 'Sin dados seleccionados.';
      btnRoll.disabled = total===0;
    }

    function cardHTML(d){
      return `
      <div class="card" data-type="${d.key}">
        <div class="icon" data-key="${d.key}">${svgIcon(d.sides)}</div>
        <div class="row"><div class="label">${d.label}</div><div class="muted">${d.sides} caras</div></div>
        <div class="row qty">
          <button data-key="${d.key}" data-act="-">âˆ’</button>
          <div class="count" data-role="count" data-key="${d.key}">0</div>
          <button data-key="${d.key}" data-act="+">+</button>
        </div>
      </div>`;
    }

    function svgIcon(sides){
      if (sides===2){
        return `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <defs><radialGradient id="g" cx="50%" cy="35%" r="65%"><stop offset="0%" stop-color="#38bdf8"/><stop offset="100%" stop-color="#0ea5e9"/></radialGradient></defs>
          <circle cx="50" cy="50" r="38" fill="url(#g)" stroke="#ffffffaa" stroke-width="3"/>
          <text x="50" y="57" text-anchor="middle" font-size="34" font-weight="900" fill="#fff">2</text>
        </svg>`;
      }
      if (sides===100){
        return `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <defs><radialGradient id="gh" cx="50%" cy="35%" r="65%"><stop offset="0%" stop-color="#a78bfa"/><stop offset="100%" stop-color="#6d28d9"/></radialGradient></defs>
          <circle cx="50" cy="50" r="38" fill="url(#gh)" stroke="#ffffffaa" stroke-width="3"/>
          <text x="50" y="57" text-anchor="middle" font-size="28" font-weight="900" fill="#fff">100</text>
        </svg>`;
      }
      // regular polygon
      const pts = polyPoints(50,50,36,sides);
      return `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="p${sides}" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#22d3ee"/><stop offset="100%" stop-color="#0ea5e9"/></linearGradient></defs>
        <polygon points="${pts}" fill="url(#p${sides})" stroke="#ffffffaa" stroke-width="3"/>
        <text x="50" y="57" text-anchor="middle" font-size="28" font-weight="900" fill="#fff">${sides}</text>
      </svg>`;
    }

    function polyPoints(cx,cy,r,n){
      const a=-Math.PI/2; const step=2*Math.PI/n; let pts=[];
      for(let i=0;i<n;i++){ const x=cx+r*Math.cos(a+i*step), y=cy+r*Math.sin(a+i*step); pts.push(`${x.toFixed(2)},${y.toFixed(2)}`); }
      return pts.join(' ');
    }

    // ===== Sprites por tipo =====
    function spriteSVG(sides, value){
      if (sides===6) return svgD6(value);
      if (sides===2) return svgCoin(value);
      return svgPolyDie(sides, value);
    }

    function svgCoin(v){
      return `<svg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'>
        <defs><radialGradient id='cg' cx='50%' cy='35%' r='65%'>
          <stop offset='0%' stop-color='#f59e0b'/><stop offset='100%' stop-color='#b45309'/>
        </radialGradient></defs>
        <circle cx='50' cy='50' r='40' fill='url(#cg)' stroke='#fff8' stroke-width='3'/>
        <text x='50' y='57' text-anchor='middle' font-size='36' font-weight='900' fill='#fff'>${v}</text>
      </svg>`;
    }

    function svgPolyDie(sides, v){
      const pts = polyPoints(50,50,38,sides);
      return `<svg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'>
        <defs><linearGradient id='lg' x1='0' y1='0' x2='1' y2='1'>
          <stop offset='0%' stop-color='#22d3ee'/><stop offset='100%' stop-color='#0ea5e9'/>
        </linearGradient></defs>
        <polygon points='${pts}' fill='url(#lg)' stroke='#fff8' stroke-width='3'/>
        <text x='50' y='57' text-anchor='middle' font-size='30' font-weight='900' fill='#fff'>${v}</text>
      </svg>`;
    }

    function svgD6(v){
      // Dado con pips reales
      const pips = {
        1:[[50,50]],
        2:[[30,30],[70,70]],
        3:[[30,30],[50,50],[70,70]],
        4:[[30,30],[70,30],[30,70],[70,70]],
        5:[[30,30],[70,30],[50,50],[30,70],[70,70]],
        6:[[30,30],[70,30],[30,50],[70,50],[30,70],[70,70]]
      }[Math.max(1,Math.min(6,v))];
      const dots = pips.map(([x,y])=>`<circle cx='${x}' cy='${y}' r='5' fill='#fff'/>`).join('');
      return `<svg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'>
        <rect x='14' y='14' width='72' height='72' rx='14' ry='14' fill='#e11d48' stroke='#fff8' stroke-width='3'/>
        ${dots}
      </svg>`;
    }

    // --- Lanzamiento secuencial DENTRO DE CADA CARD ---
    btnRoll.addEventListener('click', doRoll);
    btnAgain.addEventListener('click', ()=>{ modal.classList.remove('show'); doRoll(); });
    btnClose.addEventListener('click', ()=> modal.classList.remove('show'));

    async function doRoll(){
      const queue = [];
      for (const d of DICE){ for(let i=0;i<state[d.key];i++) queue.push({key:d.key,sides:d.sides}); }
      if (!queue.length) return;
      btnRoll.disabled = true;
      const results = [];
      for (const item of queue){
        const val = await rollInCard(item.key, item.sides);
        results.push(val);
      }
      btnRoll.disabled = false;
      showResults(queue, results);
    }

    function rollInCard(key, sides){
      return new Promise((resolve)=>{
        const icon = document.querySelector(`.icon[data-key='${key}']`);
        if (!icon) return resolve(1);
        const spr = document.createElement('div');
        spr.className = 'sprite rolling';
        icon.appendChild(spr);
        // frames aleatorios
        const tick = setInterval(()=>{
          const r = 1 + Math.floor(Math.random()*sides);
          spr.innerHTML = spriteSVG(sides, r);
        }, 70);
        // final tras ~1s
        const final = 1 + Math.floor(Math.random()*sides);
        setTimeout(()=>{
          clearInterval(tick);
          spr.classList.remove('rolling');
          spr.innerHTML = spriteSVG(sides, final);
          setTimeout(()=>{ spr.classList.add('fadeout'); setTimeout(()=> spr.remove(), 280); }, 350);
          resolve(final);
        }, 1000);
      });
    }

    function showResults(set, results){
      const sum = results.reduce((a,b)=>a+b,0);
      totalEl.textContent = `Total: ${sum}`;
      badgeEl.textContent = `${results.length} dado${results.length!==1?'s':''}`;
      const byType = new Map();
      for (let i=0;i<set.length;i++){ const k=set[i].key; if(!byType.has(k)) byType.set(k,[]); byType.get(k).push(results[i]); }
      const order = DICE.map(d=>d.key);
      const lines = [];
      for (const k of order){
        if (!byType.has(k)) continue;
        const arr = byType.get(k);
        const sides = DICE.find(d=>d.key===k).sides;
        const label = `D${sides}`;
        const subtotal = arr.reduce((a,b)=>a+b,0);
        lines.push(`<div class='line'><div>${label} (${arr.length}):</div><div>${arr.join(' + ')} = <strong>${subtotal}</strong></div></div>`);
      }
      resultList.innerHTML = lines.join('');
      modal.classList.add('show');
    }

    updateUI();
  })();
  </script>
</body>
</html>
